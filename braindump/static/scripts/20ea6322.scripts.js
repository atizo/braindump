"use strict";angular.module("braind",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","restangular","monospaced.elastic","bdDirectives"]).config(["$routeProvider","$locationProvider","$httpProvider","$provide","bdClipProvider",function(a,b,c,d,e){b.html5Mode(!0),c.defaults.xsrfHeaderName="X-CSRFToken",c.defaults.xsrfCookieName="csrftoken",a.when("/",{templateUrl:"/static/views/main.html",controller:"StartCtrl"}).when("/glitch",{templateUrl:"/static/views/glitch.html",controller:"GlitchCtrl"}).when("/:brainstorming/invite",{templateUrl:"/static/views/invite.html",controller:"InviteCtrl"}).when("/:brainstorming/edit",{templateUrl:"/static/views/edit.html",controller:"EditCtrl"}).when("/:brainstorming/notification",{templateUrl:"/static/views/notification.html",controller:"NotificationCtrl"}).when("/:brainstorming",{templateUrl:"/static/views/brainstorming.html",controller:"BrainstormingCtrl"}).otherwise({redirectTo:"/"}),e.setPath("/static/bower_components/zeroclipboard/ZeroClipboard.swf"),d.constant("brainstormingStore",angular.copy(window.brainstormingStore)),d.constant("ideaStore",angular.copy(window.ideaStore)),d.constant("recentBrainstormings",angular.copy(window.recentBrainstormings)),d.constant("errorMsg",angular.copy(window.errorMsg)),d.constant("infoMsg",angular.copy(window.infoMsg))}]).run(["$rootScope","$location","errorMsg",function(a,b,c){c&&c.length>0&&b.path("/glitch").replace(),a.user={email:angular.copy(window.email),name:angular.copy(window.name)}}]),angular.module("braind").controller("StartCtrl",["$scope","$location","brainstormingService",function(a,b,c){a.create=function(){a.user.email=a.formData.creatorEmail,c.post(a.formData).then(function(a){b.path("/"+a.id+"/invite")})},a.reset=function(){a.formData={question:"",creatorEmail:a.user.email,details:""}},c.getRecent().then(function(b){a.rb=b}),a.reset()}]),angular.module("braind").controller("InviteCtrl",["$scope","$rootScope","$location","$routeParams","brainstormingService",function(a,b,c,d,e){var f=e.get(d.brainstorming);f.then(function(b){a.bs=b,a.subject=window.encodeURIComponent(a.bs.question),a.body=window.encodeURIComponent('I would like to invite you to the brainstorming "'+a.bs.question+'"\n\nPlease follow the link in order to participate in the brainstorming:\n'+a.bs.url)},function(){c.path("/").replace()})}]),angular.module("braind").controller("BrainstormingCtrl",["$scope","$routeParams","$location","brainstormingService","bdDate",function(a,b,c,d,e){var f=b.brainstorming;d.get(f).then(function(b){b.createdFormatted=e.format(b.created),a.brainstorming=b},function(){c.path("/").replace()}),d.getIdeas(f).then(function(b){a.ideas=b}),a.getIdeaSizeClassName=function(a){var b=a.title.length+a.text.length;return 25>=b?"length-25":50>=b?"length-50":150>=b?"length-150":300>=b?"length-300":""},a.create=function(){d.postIdea(f,a.formData).then(function(){a.user.name=a.formData.creatorName,a.reset(),a.fullform=!1})},a.toolBar=[{href:"/"+f+"/notification","class":"star"},{href:"/"+f+"/edit","class":"edit"}],a.reset=function(){a.formData={title:"",text:"",creatorName:a.user.name}},a.reset()}]),angular.module("braind").controller("NotificationCtrl",["$scope","$rootScope","$location","$routeParams","brainstormingService","messageService",function(a,b,c,d,e,f){var g=e.get(d.brainstorming),h=f.getMsg();a.nuser={email:""},g.then(function(b){a.bs=b,h.length>0?a.infoMsg=h:a.submit=function(){b.post("notification",a.nuser).then(function(b){a.status={email:a.nuser.email,action:b.status}})}},function(){c.path("/").replace()})}]),angular.module("braind").controller("EditCtrl",["$scope","$rootScope","$location","$routeParams","brainstormingService",function(a,b,c,d,e){var f=e.get(d.brainstorming);a.nuser={email:""},f.then(function(b){a.bs=b,b.canEdit?(a.formData={question:b.question,details:b.details},a.update=function(){e.update(b.id,a.formData).then(function(){c.path("/"+b.id)})}):a.submit=function(){b.post("edit",a.nuser).then(function(b){a.status={email:a.nuser.email,action:b.status}})}},function(){c.path("/").replace()})}]),angular.module("braind").controller("GlitchCtrl",["$scope","errorMsg",function(a,b){a.errorMsg=b}]),angular.module("braind").factory("brainstormingService",["Restangular","$q","brainstormingStore","ideaStore","recentBrainstormings",function(a,b,c,d,e){function f(a){return i+"/"+a+"/ideas"}function g(a){return e=_.without(e,a),e.unshift(a),e}function h(a,b){return _.has(d,a)||(d[a]={}),d[a][b.id]=b,b}var i="api/brainstormings";_.forOwn(c,function(b,d){c[d]=a.restangularizeElement(null,b,i)}),_.forOwn(d,function(b,c){_.forOwn(b,function(b,e){d[c][e]=a.restangularizeElement(null,b,f(c))})});var j={};return j.get=function(d){return _.has(c,d)?(g(d),b.when(c[d])):a.one(i,d).get().then(function(a){return g(a.id),c[a.id]=a,a})},j.getRecent=function(){var a,c=10,d=[];return _(e).forEach(function(b){return a>c?!1:(d.push(j.get(b)),void(a+=1))}),b.all(d)},j.post=function(b){return a.all(i).post(b).then(function(a){return g(a.id),c[a.id]=a,a})},j.update=function(a,b){return j.get(a).then(function(a){return a.patch(b).then(function(a){return g(a.id),c[a.id]=a,a})})},j.getIdeas=function(c){return _.has(d,c)?b.when(d[c]):a.all(f(c)).getList().then(function(a){return d[c]={},_(a).forEach(function(a){d[c][a.id]=a}),d[c]})},j.getIdea=function(c,e){return _.has(d,c)&&_.has(d[c],e)?b.when(d[c][e]):a.one(f(c),e).get().then(function(a){return h(c,a)})},j.postIdea=function(b,c){return a.all(f(b)).post(c).then(function(a){return h(b,a)})},j}]),angular.module("braind").factory("bdDate",["$window",function(a){var b={};return b.formatFromNow=function(b){var c,d,e=null,f=null,g=new Date;return angular.isDate(b)||(b=new Date(b)),c=a.moment(b),d=Math.abs(a.moment().diff(c,"minute")),1320>d?(1>d?e=1:50>d?e=30:1320>d&&(e=300),f=c.fromNow()):f=c.format(c.year()===g.getFullYear()?"D. MMM HH:mm":"D. MMM YYYY HH:mm"),{fromNow:f,secondsUntilUpdate:e}},b.format=function(b,c){angular.isDate(b)||(b=new Date(b)),angular.isDefined(c)||(c="D. MMM YYYY HH:mm");var d=a.moment(b);return angular.isDefined(c)?d.format(c):d.toString()},b}]),angular.module("braind").factory("messageService",["infoMsg",function(a){var b=!0;return{getMsg:function(){return b?(b=!1,a):""}}}]),angular.module("braind").directive("bdFromNow",["$timeout","bdDate",function(a,b){return{restrict:"E",link:function(c,d,e){function f(c){var e=b.formatFromNow(c);d.text(e.fromNow),angular.isDefined(e.secondsUntilUpdate)&&(h=a(function(){f(c)},1e3*e.secondsUntilUpdate,!1))}function g(){h&&(a.cancel(h),h=null)}var h=null;c.$watch(e.value,function(a){g(),angular.isDefined(a)&&null!==a&&f(a)}),c.$on("destroy",g)}}}]),angular.module("bdDirectives",[]).provider("bdClip",function(){var a=this;return this.path="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/1.2.3/ZeroClipboard.swf",{setPath:function(b){a.path=b},$get:function(){return{path:a.path}}}}).run(["$document","bdClip",function(a,b){ZeroClipboard.config({moviePath:b.path,trustedDomains:["*"],allowScriptAccess:"always",forceHandCursor:!0})}]).directive("bdClipCopy",[function(){return{scope:{bdClipCopy:"&",bdClipClick:"&"},restrict:"A",link:function(a,b,c){var d=new ZeroClipboard(b);d.on("load",function(d){var e=function(b){b.setText(a.$eval(a.bdClipCopy)),angular.isDefined(c.bdClipClick)&&a.$apply(a.bdClipClick)};d.on("mousedown",e),a.$on("$destroy",function(){d.off("mousedown",e),d.unclip(b)})})}}}]),angular.module("braind").directive("bdHeader",[function(){return{restrict:"E",templateUrl:"/static/views/directives/bdheader.html",scope:{title:"@",action:"&",tools:"=",href:"@"}}}]);