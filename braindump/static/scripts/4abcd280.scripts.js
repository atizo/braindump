"use strict";angular.module("braind",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","restangular","monospaced.elastic","bdDirectives"]).config(["$routeProvider","$locationProvider","$httpProvider","$provide","bdClipProvider",function(a,b,c,d,e){b.html5Mode(!0),c.defaults.xsrfHeaderName="X-CSRFToken",c.defaults.xsrfCookieName="csrftoken",a.when("/",{templateUrl:"/static/views/main.html",controller:"StartCtrl"}).when("/:brainstorming/invite",{templateUrl:"/static/views/invite.html",controller:"InviteCtrl"}).when("/:brainstorming",{templateUrl:"/static/views/brainstorming.html",controller:"BrainstormingCtrl"}).otherwise({redirectTo:"/"}),e.setPath("/static/bower_components/zeroclipboard/ZeroClipboard.swf");var f=angular.copy(window.initialBrainstorming);d.constant("initialBrainstorming",f);var g=angular.copy(window.initialIdeas);d.constant("initialIdeas",g)}]).run(["$rootScope",function(a){a.user={email:angular.copy(window.email),name:angular.copy(window.name)}}]),angular.module("braind").controller("StartCtrl",["$scope","$location","Restangular","brainstormingService",function(a,b,c,d){a.create=function(){a.user.email=a.formData.creatorEmail,d.create(a.formData).then(function(a){b.path("/"+a.id+"/invite")})},a.reset=function(){a.formData={question:"",creatorEmail:a.user.email,details:""}},a.reset()}]),angular.module("braind").controller("InviteCtrl",["$scope","$rootScope","$location","brainstormingService",function(a,b,c,d){var e=d.getBrainstorming();e||c.path("/"),e.then(function(b){a.bs=b,a.subject=window.encodeURIComponent(a.bs.question),a.body=window.encodeURIComponent('I would like to invite you to the brainstorming "'+a.bs.question+'"\n\nPlease follow the link in order to participate in the brainstorming:\n'+a.bs.url)}),a.getLink=function(){return a.bs.url}}]),angular.module("braind").controller("BrainstormingCtrl",["$scope","brainstormingService","bdDate",function(a,b,c){b.getBrainstorming().then(function(b){b.createdFormatted=c.format(b.created),a.brainstorming=b}),b.getIdeas().then(function(b){a.ideas=b}),a.getIdeaSizeClassName=function(a){var b=a.title.length+a.text.length;return 25>=b?"length-25":50>=b?"length-50":150>=b?"length-150":300>=b?"length-300":""},a.create=function(){b.createIdea(a.formData).then(function(){a.user.name=a.formData.creatorName,a.reset(),a.fullform=!1})},a.reset=function(){a.formData={title:"",text:"",creatorName:a.user.name}},a.reset()}]),angular.module("braind").factory("brainstormingService",["Restangular","$q","initialBrainstorming","initialIdeas",function(a,b,c,d){function e(){i.getList("ideas").then(function(a){h=a})}var f={},g="api/brainstormings",h=null,i=null;return c&&(i=a.restangularizeElement(null,c,g),d?h=a.restangularizeCollection(i,d,"ideas"):e()),f.create=function(b){return a.all(g).post(b).then(function(a){return i=a,e(),a})},f.getBrainstorming=function(){return b.when(i)},f.getIdeas=function(){return b.when(h)},f.createIdea=function(a){return h.post(a).then(function(a){return h.unshift(a),a})},f}]),angular.module("braind").factory("bdDate",["$window",function(a){var b={};return b.formatFromNow=function(b){var c,d,e=null,f=null,g=new Date;return angular.isDate(b)||(b=new Date(b)),c=a.moment(b),d=Math.abs(a.moment().diff(c,"minute")),1320>d?(1>d?e=1:50>d?e=30:1320>d&&(e=300),f=c.fromNow()):f=c.format(c.year()===g.getFullYear()?"D. MMM HH:mm":"D. MMM YYYY HH:mm"),{fromNow:f,secondsUntilUpdate:e}},b.format=function(b,c){angular.isDate(b)||(b=new Date(b)),angular.isDefined(c)||(c="D. MMM YYYY HH:mm");var d=a.moment(b);return angular.isDefined(c)?d.format(c):d.toString()},b}]),angular.module("braind").directive("bdFromNow",["$timeout","bdDate",function(a,b){return{restrict:"E",link:function(c,d,e){function f(c){var e=b.formatFromNow(c);d.text(e.fromNow),angular.isDefined(e.secondsUntilUpdate)&&(h=a(function(){f(c)},1e3*e.secondsUntilUpdate,!1))}function g(){h&&(a.cancel(h),h=null)}var h=null;c.$watch(e.value,function(a){g(),angular.isDefined(a)&&null!==a&&f(a)}),c.$on("destroy",g)}}}]),angular.module("bdDirectives",[]).provider("bdClip",function(){var a=this;return this.path="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/1.2.3/ZeroClipboard.swf",{setPath:function(b){a.path=b},$get:function(){return{path:a.path}}}}).run(["$document","bdClip",function(a,b){ZeroClipboard.config({moviePath:b.path,trustedDomains:["*"],allowScriptAccess:"always",forceHandCursor:!0})}]).directive("bdClipCopy",["$window","bdClip",function(){return{scope:{bdClipCopy:"&",bdClipClick:"&"},restrict:"A",link:function(a,b,c){var d=new ZeroClipboard(b);d.on("load",function(d){var e=function(b){b.setText(a.$eval(a.bdClipCopy)),angular.isDefined(c.bdClipClick)&&a.$apply(a.bdClipClick)};d.on("mousedown",e),a.$on("$destroy",function(){d.off("mousedown",e),d.unclip(b)})})}}}]),angular.module("braind").directive("bdHeader",[function(){return{restrict:"E",templateUrl:"/static/scripts/directives/templates/bdheader.html",scope:{title:"@",action:"&",href:"@"}}}]);